---
title: "Influence of demographic characteristic on Covid-19 kinetics"
author: "Mette Christoffersen, Signe Modvig, Hans Jakob Hartling and Mette Christensen"
date: "15 5 2020"
output: 
  ioslides_presentation: 
    widescreen: true
    logo: Corp_Red_RGB.png
    

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library("tidyverse")
library("knitr")
library("kableExtra")
```

## Selected outcome variables 

<div class="centered">
![](../results/04_analysis_aim/COVID-19 mortality by country.png){ width=80%, height=80% }

<font size="3">[Global map - days from 100 cases to 100 deaths](map_days_from_100_cases_to_100_deaths.html)</font>
<font size="3">[Global map - days from december 1st to 100 cases](map_days_from_dec1_to_100_cases.html)</font>

## Aim and hypothesis

<br>
<font size="5"> Linking exposure variables (demograhic/population data etc) to:</font> <br>
<font size="4"> 1. Days from 100 cases to 100 deaths <br>
2. Days from December 1st to 100 deaths </br> </font> 
<br>
<br>

<font size="5"> That demographic factors like urbanisation and median age affects COVID-19 kinetics</font>




 
## Datasets - overview of data 
<div class="centered">
![](../results/04_analysis_flowcharts/variables_overview1.png){ width=60%, height=60% }
![](../results/04_analysis_flowcharts/variables_overview2.png){ width=80%, height=80% }
</div>

## Datasets - cleaning, augmenting and joining
<div class="centered">
![](../results/04_analysis_flowcharts/flowchart_design.png){ width=100%, height=100% }
</div>


## Methods - study design
<div class="centered">
![](../results/04_analysis_flowcharts/flowchart_analyses.png){ width=90%, height=90% }</div>
<div class="black">
<font size="4">Non-course packages</font> <br>
<font size="3">
Lubridate (converting to date)
; PMCMRplus (p-values, Cuzick Test)
; DiagrammeR + DiagrammeRsvg + rsvg (flowcharts)
; leaflet (making world maps)
; htmlwidgets (saving interactiv plots)
; survivalAnalysis (Survival analysis)
; gganimate and gifski (making and saving gif)
; scales (modify scales on ggplot)!</font>
</div>

## Covid-19 cases and deaths in each country
![](../results/04_analysis_point_plots/cases_deaths_log.gif)

## Results - selection of exposure variables 
<br>
- Liniar correlation analysis lm(days from december 1st to 100 cases ~ diff. exposure variables) <br>
- Significant correlations:
<br>

```{r include=FALSE, paged.print=FALSE}

covid_aug <- read_tsv(file = "../data/03_covid_aug.tsv")

covid_aug_by_country <- covid_aug %>% 
  group_by(country) %>% 
  slice(which.max(date)) 


# Linear regression - COVID-19 cases and covariates
# ------------------------------------------------------------------------------

#Check for correlation between covariates

model1 <- lm(days_from_dec1_to_100_cases ~ life_expectancy + pollution_attributable_death_rate_std +
               current_health_expenditure_per_person_usd + population_living_in_urban_areas +
               population_aged_60_years_old_percentage + respiratory_diseases, data = covid_aug_by_country)

summary(model1)


model1_final <- lm(days_from_dec1_to_100_cases ~ life_expectancy + 
               population_living_in_urban_areas + respiratory_diseases, data = covid_aug_by_country) 
 
model1_final<-summary(model1_final)


model2 <- lm(days_from_100_cases_to_100_deaths ~ life_expectancy + pollution_attributable_death_rate_std +
               current_health_expenditure_per_person_usd + population_living_in_urban_areas +
               population_aged_60_years_old_percentage + respiratory_diseases, data = covid_aug_by_country)

summary(model2)


```




```{r Table 1, echo=FALSE, paged.print=FALSE, results="asis"}

cor_covar = round(coefficients(model1_final), digits = 6) 

cor_covar %>% 
  kable(caption = "Table 1. Correlation between covariats", format = "html") %>% 
  kableExtra::kable_styling(position = "center", font_size = 12, bootstrap_options = "striped", full_width = FALSE)


```




## Respiratory diseases
<div class="columns-2">
  <div class="centered">
  ![](../results/04_analysis_exploratory_figures/Cases_respiratory_diseases_ter.png){ width=70%, height=70% }
  ![](../results/04_analysis_survival/KM_respiratory_diseases_ter.png){width=70%, height=70% }

   ![](../results/04_analysis_point_plots/cases_respiratory_diseases.png){ width=110%, height=110% }
   - <font size="3"> A clear association to COVID-19 case- and mortality kinetics was seen for respiratory diseases (p<0.001, log-rank test) </font>
</div>

## Life expectancy
<div class="columns-2">
  <div class="centered">
  ![](../results/04_analysis_exploratory_figures/Cases_life_expectancy_ter.png){ width=70%, height=70% }
  ![](../results/04_analysis_survival/KM_life_expectancy_ter.png){width=70%, height=70% }

  ![](../results/04_analysis_point_plots/cases_life_expectancy.png){ width=110%, height=110% }
   - <font size="3"> Life expectancy also associates with COVID-19 case- and mortality kinetics (p=0.021, log-rank test)</font>
</div>

## Population % living in urban areas

<div class="columns-2">
  <div class="centered">
  ![](../results/04_analysis_exploratory_figures/Cases_population_living_in_urban_areas_ter.png){ width=70%, height=70% }
  ![](../results/04_analysis_survival/KM_population_living_in_urban_areas_ter.png){width=70%, height=70% }

  ![](../results/04_analysis_point_plots/cases_population_living_in_urban_areas.png){ width=110%, height=110% }
     - <font size="3"> A similar association was seen for % of population in urban area (p=0.013, log-rank test)</font>

</div>

## PCA analysis by population demographics
<div class="columns-2">
  <div class="centered">
  ![](../results/04_analysis_PCA/pca_deaths.png){ width=105%, height=105% }
  
  - PCA showed a clear association with COVID-19 kinetics
  - Relative COVID-19 deaths were more informative than absolute deaths
  - PC1 comprises 44.6% of variation
   
  ![](../results/04_analysis_PCA/PC_significance.png){ width=60%, height=60% }

## PCA and cluster analysis
  <div class="columns-2">
  <div class="centered">
  ![](../results/04_analysis_PCA/pca_cluster_rel_deaths.png){ width=110%, height=110% }
  
  - Cluster analysis (n=3) based on population demographics data (middle) and on PCA (right) 
  - Cluster analysis does not capture COVID-19 kinetics accurately
  


## COVID-19 app

<div class="left">

Confirmed cases, test and death in time series 

<font size="3">https://r-kursus.shinyapps.io/covid_app/</font>


## Another explanation? {.flexbox .vcenter}
<div class="columns-2">
<div class="centered">
![](../results/04_analysis_exploratory_figures/COVID-19 spread by gender of national leader.png){ width=100%, height=100% }

![](../doc/donald_trump.png){ width=50%, height=100% }
![](../doc/mette_frederiksen.png){ width=50%, height=100% }
</div>

</div>

## Another explanation? {.flexbox .vcenter}
<div class="columns-2">
<div class="centered">
![](../results/04_analysis_exploratory_figures/COVID-19 spread by gender of national leader.png){ width=100%, height=100% }
<div class="black">
OR JUST CONFOUNDING BY DEVELOPMENTAL STATUS OF THE COUNTRIES...
</div>
![](../doc/Developed_and_developing_countries.png){ width=100%, height=100%}
</div>

## Conclusion - A small virus in a world full of data
  ![](https://ing.dk/sites/ing/files/topillustration/2020/03/2019-ncov-cdc-23312coronavirus.png){ width=30%, height=30%}
   
  
  - This project demonstrates the strength of Tidyverse R by cleansing, transformation, visualization and communication Covid-19 data
  - Performed focusing on reproducibility
  - All data analysis is available at github (https://github.com/rforbiodatascience/2020_group02)


